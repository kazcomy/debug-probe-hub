version: '3.8'

services:
  # General ARM tools container (OpenOCD, J-Link)
  debug-box-general:
    build:
      context: ./docker/general
      dockerfile: Dockerfile
    image: debug-probe-hub-general:latest
    container_name: debug-box-general
    privileged: true
    volumes:
      - /dev:/dev
      - /tmp/flash_staging:/work
      - ./config.yml:/config.yml:ro
    command: sleep infinity
    network_mode: host
    restart: unless-stopped

  # ESP32 tools container (OpenOCD-ESP32)
  debug-box-esp:
    build:
      context: ./docker/esp32
      dockerfile: Dockerfile
    image: debug-probe-hub-esp:latest
    container_name: debug-box-esp
    privileged: true
    volumes:
      - /dev:/dev
      - /tmp/flash_staging:/work
      - ./config.yml:/config.yml:ro
    command: sleep infinity
    network_mode: host
    restart: unless-stopped

  # WCH RISC-V tools container
  debug-box-wch:
    build:
      context: ./docker/wch
      dockerfile: Dockerfile
    image: debug-probe-hub-wch:latest
    container_name: debug-box-wch
    privileged: true
    volumes:
      - /dev:/dev
      - /tmp/flash_staging:/work
      - ./config.yml:/config.yml:ro
    command: sleep infinity
    network_mode: host
    restart: unless-stopped
