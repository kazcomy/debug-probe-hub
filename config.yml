# Debugger Station Configuration

# Server settings
server:
  port: 8080
  upload_dir: /tmp/flash_staging

# Container definitions
containers:
  jlink:
    name: debug-box-jlink
    image_name: debug-probe-hub-jlink
    build_context: ./docker/general
    description: "ARM tools for J-Link"

  cmsis_dap:
    name: debug-box-cmsisdap
    image_name: debug-probe-hub-cmsisdap
    build_context: ./docker/general
    description: "ARM tools for CMSIS-DAP"

  esp32:
    name: debug-box-esp
    image_name: debug-probe-hub-esp
    build_context: ./docker/esp32
    description: "ESP32 tools (OpenOCD-ESP32)"

  wch:
    name: debug-box-wch
    image_name: debug-probe-hub-wch
    build_context: ./docker/wch
    description: "WCH RISC-V tools (WCH OpenOCD)" 

# Debug probe definitions
probes:
  - id: 1
    name: "Segger J-Link"
    serial: "000051025665"
    vendor_id: "1366"
    product_id: "0105"
    interface: jlink

# if wch-link should be used in ARM mode, change product_id to 8012
  - id: 2
    name: "WCH-Link (RISC-V #1)"
    serial: "C2428F064718"
    vendor_id: "1a86"
    product_id: "8010"
    interface: wch-link

  - id: 3
    name: "WCH-Link (RISC-V #2)"
    serial: "03AF8F068882"
    vendor_id: "1a86"
    product_id: "8010"
    interface: wch-link

  - id: 4
    name: "WCH-Link (RISC-V #3)"
    serial: "50CE8F06D5AF"
    vendor_id: "1a86"
    product_id: "8010"
    interface: wch-link

# Target device definitions
targets:
  nrf52840:
    container:
      jlink: jlink
      cmsis-dap: cmsis_dap
    description: "Nordic nRF52840"
    compatible_probes: [jlink, cmsis-dap]
    transports:
      jlink:
        default: swd
        allowed: [swd]
      cmsis-dap:
        default: swd
        allowed: [swd]
    commands:
      jlink:
        debug: "JLinkGDBServer -device nRF52840_xxAA -if SWD -speed 4000 -port {gdb_port} -select USB={serial}"
        flash: |
          cat > /tmp/flash_nrf.jlink <<EOF
          Select USB={serial}
          device nRF52840_xxAA
          if SWD
          speed 4000
          loadfile {firmware_path}
          r
          q
          EOF
          JLinkExe -CommandFile /tmp/flash_nrf.jlink
        print: "JLinkRTTClient -Device nRF52840_xxAA -if SWD -Speed 4000 -Select USB={serial} -RTTTelnetPort {rtt_port}"
      cmsis-dap:
        debug: "openocd -f interface/cmsis-dap.cfg -f target/nrf52.cfg -c 'adapter serial {serial}' -c 'gdb_port {gdb_port}' -c 'telnet_port {telnet_port}' -c 'tcl_port disabled' -c 'bindto 0.0.0.0'"
        flash: "openocd -f interface/cmsis-dap.cfg -f target/nrf52.cfg -c 'adapter serial {serial}' -c 'program {firmware_path} verify reset exit'"

  esp32s3:
    container:
      esp-usb-jtag: esp32
    description: "Espressif ESP32-S3"
    compatible_probes: [esp-usb-jtag]
    transports:
      esp-usb-jtag:
        default: jtag
        allowed: [jtag]
    commands:
      esp-usb-jtag:
        debug: "openocd -f interface/esp_usb_jtag.cfg -f target/esp32s3.cfg -c 'gdb_port {gdb_port}' -c 'telnet_port {telnet_port}' -c 'bindto 0.0.0.0'"
        flash: "openocd -f interface/esp_usb_jtag.cfg -f target/esp32s3.cfg -c 'program_esp {firmware_path} 0x0 verify reset exit'"

  stm32g4:
    container:
      jlink: jlink
      cmsis-dap: cmsis_dap
    description: "STM32G4 series"
    compatible_probes: [jlink, cmsis-dap]
    transports:
      jlink:
        default: swd
        allowed: [swd, jtag]
      cmsis-dap:
        default: swd
        allowed: [swd, jtag]
    commands:
      jlink:
        debug: "openocd -f interface/jlink.cfg -c 'transport select {transport}' -f target/stm32g4x.cfg -c 'jlink serial {serial}' -c 'gdb_port {gdb_port}' -c 'telnet_port {telnet_port}' -c 'bindto 0.0.0.0'"
        flash: "openocd -f interface/jlink.cfg -c 'transport select {transport}' -f target/stm32g4x.cfg -c 'jlink serial {serial}' -c 'program {firmware_path} verify reset exit'"
      cmsis-dap:
        debug: "openocd -f interface/cmsis-dap.cfg -c 'transport select {transport}' -f target/stm32g4x.cfg -c 'adapter serial {serial}' -c 'gdb_port {gdb_port}' -c 'telnet_port {telnet_port}' -c 'bindto 0.0.0.0'"
        flash: "openocd -f interface/cmsis-dap.cfg -c 'transport select {transport}' -f target/stm32g4x.cfg -c 'adapter serial {serial}' -c 'program {firmware_path} verify reset exit'"

  ch32v003:
    container: wch
    description: "WCH CH32V series (RISC-V)"
    compatible_probes: [wch-link]
    transports:
      wch-link:
        default: sdi
        allowed: [sdi]
    commands:
      wch-link:
        flash: "openocd -f /opt/wch-toolchain/OpenOCD/OpenOCD/bin/wch-riscv.cfg -c 'adapter serial {serial}' -c 'program {firmware_path} verify reset exit'"
        debug: "openocd -f /opt/wch-toolchain/OpenOCD/OpenOCD/bin/wch-riscv.cfg -c 'adapter serial {serial}' -c 'gdb_port {gdb_port}' -c 'telnet_port {telnet_port}' -c 'bindto 0.0.0.0'"
        print: "wlink serial | socat STDIN TCP-LISTEN:{rtt_port},reuseaddr,fork,bind=0.0.0.0"

  ch32v203:
    container: wch
    description: "WCH CH32V series (RISC-V)"
    compatible_probes: [wch-link]
    transports:
      wch-link:
        default: sdi
        allowed: [sdi]
    commands:
      wch-link:
        flash: "openocd -f /opt/wch-toolchain/OpenOCD/OpenOCD/bin/wch-riscv.cfg -c 'adapter serial {serial}' -c 'program {firmware_path} verify reset exit'"
        debug: "openocd -f /opt/wch-toolchain/OpenOCD/OpenOCD/bin/wch-riscv.cfg -c 'adapter serial {serial}' -c 'gdb_port {gdb_port}' -c 'telnet_port {telnet_port}' -c 'bindto 0.0.0.0'"
        print: "wlink serial | socat STDIN TCP-LISTEN:{rtt_port},reuseaddr,fork,bind=0.0.0.0"

# Port allocation
ports:
  gdb_base: 3330
  telnet_base: 4440
  rtt_base: 9090  # Base port for RTT/print output (accessible from remote clients)
